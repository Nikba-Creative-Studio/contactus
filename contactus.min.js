(()=>{var o=class{constructor(e="#contactus"){if(this.config={prefix:"contactus",version:"2.0.1",core:"https://contactus.nikba.com/",defaultTitle:"Need help? Contact us!!"},this.messengers={facebook:{url:"https://m.me/",label:"Write a message",icon:"fab fa-facebook-messenger"},whatsapp:{url:"https://wa.me/",label:"Write a message",icon:"fab fa-whatsapp"},viber:{url:"viber://chat?number=",label:"Write a message",icon:"fab fa-viber"},telegram:{url:"https://t.me/",label:"Write a message",icon:"fab fa-telegram"},call:{url:"tel:",label:"Call us",icon:"fas fa-phone"}},this.container=document.querySelector(e),this.isOpen=!1,!this.container){console.error(`ContactWidget: Container ${e} not found`);return}this.init()}async init(){await this.loadStyles(),this.createElements(),this.bindEvents(),this.trackUsage()}async loadStyles(){return new Promise(e=>{let t=document.createElement("link");t.rel="stylesheet",t.href=`${this.config.core}assets/css/style.css?v=${this.config.version}`,t.onload=e,document.head.appendChild(t)})}createElements(){this.createMainButton(),this.createMainBox(),this.applyPosition()}createMainButton(){this.mainButton=this.createElement("div",{className:`${this.config.prefix}_btn`,innerHTML:`
          <div class="${this.config.prefix}_btn_icon"></div>
          <div class="${this.config.prefix}_btn_alert">1</div>
        `}),this.container.appendChild(this.mainButton)}createMainBox(){this.mainBox=this.createElement("div",{className:`${this.config.prefix}_box`}),this.container.appendChild(this.mainBox)}applyPosition(){this.container.getAttribute("position")==="left"&&(this.mainButton.classList.add(`${this.config.prefix}_btn_left`),this.mainBox.classList.add(`${this.config.prefix}_box_left`))}createElement(e,t={}){let i=document.createElement(e);return Object.entries(t).forEach(([s,n])=>{s==="className"?i.className=n:s==="innerHTML"?i.innerHTML=n:s==="textContent"?i.textContent=n:i.setAttribute(s,n)}),i}bindEvents(){this.mainButton.addEventListener("click",()=>this.toggleBox()),document.addEventListener("click",e=>{this.isOpen&&!this.container.contains(e.target)&&this.closeBox()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isOpen&&this.closeBox()})}toggleBox(){this.isOpen?this.closeBox():this.openBox()}openBox(){this.isOpen=!0,this.mainButton.classList.add("opened"),this.mainBox.classList.add("opened"),this.clearBox(),this.renderBoxContent()}closeBox(){this.isOpen=!1,this.mainButton.classList.remove("opened"),this.mainBox.classList.remove("opened"),setTimeout(()=>this.clearBox(),300)}clearBox(){this.mainBox.innerHTML=""}renderBoxContent(){this.renderHeader(),this.renderMessengers()}renderHeader(){let e=this.container.getAttribute("title")||this.config.defaultTitle,t=this.createElement("div",{className:`${this.config.prefix}_box_header`,innerHTML:`
          <span class="${this.config.prefix}_box_header_title">${e}</span>
          <a href="https://contactus.nikba.com/" 
             target="_blank" 
             class="${this.config.prefix}_box_header_logo"
             aria-label="Powered by ContactUs">
          </a>
        `});this.mainBox.appendChild(t)}renderMessengers(){Object.entries(this.messengers).forEach(([e,t])=>{let i=this.container.getAttribute(e);if(i){let s=this.createMessengerElement(e,i,t);this.mainBox.appendChild(s)}})}createMessengerElement(e,t,i){let s=this.container.getAttribute(`${e}-label`)||i.label,n=this.capitalize(e);e==="call"&&(n=this.formatPhoneNumber(t));let a=this.createElement("a",{className:`${this.config.prefix}_box_item`,href:i.url+t,target:"_blank","aria-label":`${s} via ${e}`,innerHTML:`
          <span class="${this.config.prefix}_box_item_btn ${this.config.prefix}_${e}">
            <div class="${this.config.prefix}_item_btn_icon"></div>
          </span>
          <span class="${this.config.prefix}_item_label">
            ${n}
            <span class="${this.config.prefix}_item_sub_label">${s}</span>
          </span>
        `});return a.addEventListener("click",()=>{this.trackClick(e)}),a}capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}trackClick(e){typeof gtag<"u"&&gtag("event","contact_click",{platform:e,widget_version:this.config.version})}async trackUsage(){try{await fetch(`https://nikba.com/contactus.php?ref=${window.location.hostname}`,{method:"GET",mode:"no-cors"})}catch(e){console.warn("ContactWidget: Analytics tracking failed",e)}}show(){this.container.style.display="block"}hide(){this.container.style.display="none"}updateTitle(e){if(this.container.setAttribute("title",e),this.isOpen){let t=this.mainBox.querySelector(`.${this.config.prefix}_box_header_title`);t&&(t.textContent=e)}}addMessenger(e,t){this.messengers[e]=t}removeMessenger(e){delete this.messengers[e]}destroy(){this.container.innerHTML="",document.removeEventListener("click",this.handleOutsideClick),document.removeEventListener("keydown",this.handleEscapeKey)}updatePhoneNumber(e){this.container.setAttribute("call",e),this.messengers.call.label=e,this.isOpen&&(this.clearBox(),this.renderBoxContent())}formatPhoneNumber(e){let t=e.replace(/[^\d+]/g,""),i=t.match(/^(\+\d{3})(\d{2})(\d{3})(\d{3})$/);return i?`${i[1]} ${i[2]} ${i[3]} ${i[4]}`:t.startsWith("+")?t.replace(/(\+\d{3})(\d{3})(\d{3})(\d{3})?/,(s,n,a,c,l)=>[n,a,c,l].filter(Boolean).join(" ")):e}};document.addEventListener("DOMContentLoaded",()=>{document.querySelector("#contactus")&&(window.contactWidget=new o)});})();
